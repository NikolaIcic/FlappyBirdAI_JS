(()=>{"use strict";class s{constructor(){this.alive=!0,this.color=0,this.x=35,this.y=40,this.speed=0,this.score=0,this.ref=null,this.Bias=new Array(3),this.Weights=new Array(2),this.Bias[0]=new Array(4),this.Bias[1]=new Array(2),this.Weights[0]=new Array(8),this.Weights[1]=new Array(2);for(let s=0;s<8;s++)this.Weights[0][s]=2*Math.random()-1;for(let s=0;s<2;s++)this.Weights[1][s]=2*Math.random()-1}Jump(){this.speed=-.7}AI(s,t,e){this.Bias[0][0]=this.y/100,this.Bias[0][1]=(s-this.x)/100,this.Bias[0][2]=(t-this.y+4)/100,this.Bias[0][3]=(t+e-this.y-3)/100,this.Bias[1][0]=this.Bias[0][0]*this.Weights[0][0]+this.Bias[0][1]*this.Weights[0][1]+this.Bias[0][2]*this.Weights[0][2]+this.Bias[0][3]*this.Weights[0][3],this.Bias[1][1]=this.Bias[0][0]*this.Weights[0][4]+this.Bias[0][1]*this.Weights[0][5]+this.Bias[0][2]*this.Weights[0][6]+this.Bias[0][3]*this.Weights[0][7],this.Bias[2]=this.Bias[1][0]*this.Weights[1][0]+this.Bias[1][1]*this.Weights[1][1],this.Bias[2]>0&&(this.speed=-.7)}}class t{constructor(s){this.x=85,this.y=s,this.ref=null}}class e{constructor(t){this.Birds=[],this.Obstacles=[],this.currentObs=null,this.gameOn=!1,this.startGame=!0,this.canvas=t,this.Hole=25,this.AccelerationY=.016,this.SpeedX=.19,this.TopScore=0,this.Score=0,this.Generation=0,this.NumOfBirds=55,this.NumOfRandom=55,this.Birds.push(new s)}AddBird(){this.Birds.push(new s)}AddObstacle(){let s=new t(Math.floor(Math.random()*(100-this.Hole-13))+2),e=document.createElement("div");e.className="Obstacle",e.style.left=s.x+"%",this.canvas.appendChild(e),s.ref=e,this.Obstacles.push(s);let i=document.createElement("div");i.className="ObsPart",i.style.height=s.y+"vh";let h=document.createElement("div");h.className="ObsPart",h.style.height=100-s.y-this.Hole+"vh",h.style.marginTop=this.Hole+"vh",e.appendChild(i),e.appendChild(h),null==this.currentObs&&(this.currentObs=s)}CreateObstacles(){setInterval((()=>{this.gameOn&&this.AddObstacle()}),2e3)}CreateBirds(s){for(let t=0;t<s;t++)this.AddBird()}DrawBirds(){this.Birds.forEach((s=>{let t=document.createElement("div");0==s.color?t.className="Bird":1==s.color?t.className="BirdChampion":2==s.color?t.className="BirdChild":3==s.color?t.className="BirdMutation":4==s.color&&(t.className="BirdCombination"),t.style.top=s.y+"%",t.style.left=s.x+"%",this.canvas.appendChild(t),s.ref=t}))}Invalidate(){setInterval((()=>{this.gameOn&&(this.Birds.forEach((s=>{s.alive?(s.speed+=this.AccelerationY,s.y+=s.speed,s.ref.style="transform: rotate("+45*s.speed+"deg)",s.ref.style.top=s.y+"%",s.ref.style.left=s.x+"%"):s.x>0&&(s.x-=this.SpeedX,s.ref.style.left=s.x+"%",s.y<89&&(s.y+=.7,s.ref.style.top=s.y+"%"))})),this.Obstacles.forEach((s=>{s.x-=this.SpeedX,s.ref.style.left=s.x+"%"})))}),10)}Checkup(){setInterval((()=>{this.Birds.forEach((s=>{s.alive&&(s.y>=87||s.y<=5)&&(s.score=this.Score,s.alive=!1)})),null!=this.currentObs&&this.currentObs.x>=31&&this.currentObs.x<=41&&this.Birds.forEach((s=>{s.alive&&(s.y<=this.currentObs.y+5||s.y>=this.currentObs.y+this.Hole-3)&&(s.score=this.Score,s.alive=!1)})),this.Obstacles.forEach(((s,t)=>{s.x<=14&&(s.ref.remove(),this.Obstacles.shift())})),null!=this.currentObs&&this.currentObs.x<30&&(this.currentObs=this.Obstacles[1],this.Score++,document.getElementsByClassName("Score")[0].innerHTML="score:"+this.Score)}),1)}Gameover(){setInterval((()=>{let s=!0;for(let t=0;t<this.Birds.length;t++)if(this.Birds[t].alive){s=!1;break}s&&this.gameOn&&setTimeout((()=>{this.gameOn=!1,setTimeout((()=>{this.NewGame(!1)}),500)}),700)}),800)}NewGame(t){this.Birds[0].alive=!0,this.Birds[0].color=1,this.Birds[0].x=35,this.Birds[0].y=40,this.Birds[0].speed=0,this.Birds[0].score=0,this.Birds.forEach((s=>{if(s.score>this.TopScore){this.TopScore=s.score;for(let t=0;t<8;t++)this.Birds[0].Weights[0][t]=s.Weights[0][t];for(let t=0;t<2;t++)this.Birds[0].Weights[1][t]=s.Weights[1][t]}})),this.Birds.forEach((s=>{null!=s.ref&&s.ref.remove()})),this.Obstacles.forEach((s=>{null!=s.ref&&s.ref.remove()})),this.Birds.splice(1,this.Birds.length-1),this.Obstacles.splice(0,this.Obstacles.length),this.currentObs=null,this.startGame=t,this.Score=0,this.Generation++,document.getElementsByClassName("Info1")[0].innerHTML=`TopScore:${this.TopScore}<br>Generation:${this.Generation}`,document.getElementsByClassName("Score")[0].innerHTML="score:"+this.Score,this.startGame||(this.gameOn=!0),this.TopScore>=1&&(this.NumOfRandom=20);for(let t=0;t<this.NumOfBirds-this.NumOfRandom;t++){let t=new s;if(50*Math.random()>7){t.color=2;for(let s=0;s<8;s++)t.Weights[0][s]=this.Birds[0].Weights[0][s]+(4*Math.random()-2)/10;for(let s=0;s<2;s++)t.Weights[1][s]=this.Birds[0].Weights[1][s]+(4*Math.random()-2)/10}else if(50*Math.random()>25){t.color=4;for(let s=0;s<8;s++)30*Math.random()>25?t.Weights[0][s]=2*Math.random()-1:t.Weights[0][s]=this.Birds[0].Weights[0][s];for(let s=0;s<2;s++)20*Math.random()>14?t.Weights[1][s]=2*Math.random()-1:t.Weights[1][s]=this.Birds[0].Weights[1][s]}else t.color=3,t.Weights[0][Math.floor(8*Math.random())]=2*Math.random()-1;this.Birds.push(t)}this.CreateBirds(this.NumOfRandom),this.DrawBirds(this.canvas)}Jump(){this.Birds.forEach((s=>{s.Jump()}))}BirdAI(){setInterval((()=>{this.Birds.forEach((s=>{s.alive&&(null!=this.currentObs?s.AI(this.currentObs.x,this.currentObs.y,this.Hole):s.AI(90,25,this.Hole))}))}),10)}Test(){this.Birds.forEach((s=>{console.log(s)}))}}window.onload=()=>{const s=document.getElementById("main"),t=new e(s);t.DrawBirds(),t.CreateObstacles(),t.Invalidate(),t.Checkup(),t.Gameover(),t.BirdAI(),s.onclick=()=>{t.startGame&&!t.gameOn?(t.startGame=!1,t.gameOn=!0):t.Jump()}}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9mYmFpX3JlLy4vc3JjL2JpcmQuanMiLCJ3ZWJwYWNrOi8vZmJhaV9yZS8uL3NyYy9vYnN0YWNsZS5qcyIsIndlYnBhY2s6Ly9mYmFpX3JlLy4vc3JjL2dhbWUuanMiLCJ3ZWJwYWNrOi8vZmJhaV9yZS8uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJCaXJkIiwidGhpcyIsImFsaXZlIiwiY29sb3IiLCJ4IiwieSIsInNwZWVkIiwic2NvcmUiLCJyZWYiLCJCaWFzIiwiQXJyYXkiLCJXZWlnaHRzIiwiaSIsIk1hdGgiLCJyYW5kb20iLCJPYnNYIiwiT2JzWSIsIkhvbGVTaXplIiwiT2JzdGFjbGUiLCJPYnN5IiwiR2FtZSIsImNhbnZzIiwiQmlyZHMiLCJPYnN0YWNsZXMiLCJjdXJyZW50T2JzIiwiZ2FtZU9uIiwic3RhcnRHYW1lIiwiY2FudmFzIiwiSG9sZSIsIkFjY2VsZXJhdGlvblkiLCJTcGVlZFgiLCJUb3BTY29yZSIsIlNjb3JlIiwiR2VuZXJhdGlvbiIsIk51bU9mQmlyZHMiLCJOdW1PZlJhbmRvbSIsInB1c2giLCJvYnMiLCJmbG9vciIsImRpdiIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTmFtZSIsInN0eWxlIiwibGVmdCIsImFwcGVuZENoaWxkIiwicGFydDEiLCJoZWlnaHQiLCJwYXJ0MiIsIm1hcmdpblRvcCIsInNldEludGVydmFsIiwiQWRkT2JzdGFjbGUiLCJudW0iLCJBZGRCaXJkIiwiZm9yRWFjaCIsImJpcmQiLCJ0b3AiLCJpbmRleCIsInJlbW92ZSIsInNoaWZ0IiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImlubmVySFRNTCIsImFsbGRlYWQiLCJsZW5ndGgiLCJzZXRUaW1lb3V0IiwiTmV3R2FtZSIsImNsaWNrVG9TdGFydCIsImVsIiwic3BsaWNlIiwiYiIsImoiLCJDcmVhdGVCaXJkcyIsIkRyYXdCaXJkcyIsIkp1bXAiLCJBSSIsImNvbnNvbGUiLCJsb2ciLCJ3aW5kb3ciLCJvbmxvYWQiLCJnZXRFbGVtZW50QnlJZCIsImciLCJDcmVhdGVPYnN0YWNsZXMiLCJJbnZhbGlkYXRlIiwiQ2hlY2t1cCIsIkdhbWVvdmVyIiwiQmlyZEFJIiwib25jbGljayJdLCJtYXBwaW5ncyI6Im1CQUFPLE1BQU1BLEVBRVQsY0FDSUMsS0FBS0MsT0FBUSxFQUNiRCxLQUFLRSxNQUFRLEVBQ2JGLEtBQUtHLEVBQUksR0FDVEgsS0FBS0ksRUFBSSxHQUNUSixLQUFLSyxNQUFRLEVBQ2JMLEtBQUtNLE1BQVEsRUFDYk4sS0FBS08sSUFBTSxLQUNYUCxLQUFLUSxLQUFPLElBQUlDLE1BQU0sR0FDdEJULEtBQUtVLFFBQVUsSUFBSUQsTUFBTSxHQUN6QlQsS0FBS1EsS0FBSyxHQUFLLElBQUlDLE1BQU0sR0FDekJULEtBQUtRLEtBQUssR0FBSyxJQUFJQyxNQUFNLEdBQ3pCVCxLQUFLVSxRQUFRLEdBQUssSUFBSUQsTUFBTSxHQUM1QlQsS0FBS1UsUUFBUSxHQUFLLElBQUlELE1BQU0sR0FDNUIsSUFBSSxJQUFJRSxFQUFFLEVBQUVBLEVBQUUsRUFBRUEsSUFDWlgsS0FBS1UsUUFBUSxHQUFHQyxHQUFvQixFQUFkQyxLQUFLQyxTQUFZLEVBRTNDLElBQUksSUFBSUYsRUFBRSxFQUFFQSxFQUFFLEVBQUVBLElBQ1pYLEtBQUtVLFFBQVEsR0FBR0MsR0FBb0IsRUFBZEMsS0FBS0MsU0FBWSxFQUcvQyxPQUNJYixLQUFLSyxPQUFTLEdBRWxCLEdBQUdTLEVBQUtDLEVBQUtDLEdBRVRoQixLQUFLUSxLQUFLLEdBQUcsR0FBS1IsS0FBS0ksRUFBSSxJQUMzQkosS0FBS1EsS0FBSyxHQUFHLElBQU1NLEVBQU9kLEtBQUtHLEdBQUssSUFDcENILEtBQUtRLEtBQUssR0FBRyxJQUFNTyxFQUFPZixLQUFLSSxFQUFJLEdBQUssSUFDeENKLEtBQUtRLEtBQUssR0FBRyxJQUFNTyxFQUFPQyxFQUFXaEIsS0FBS0ksRUFBSSxHQUFLLElBRW5ESixLQUFLUSxLQUFLLEdBQUcsR0FBS1IsS0FBS1EsS0FBSyxHQUFHLEdBQUtSLEtBQUtVLFFBQVEsR0FBRyxHQUFLVixLQUFLUSxLQUFLLEdBQUcsR0FBS1IsS0FBS1UsUUFBUSxHQUFHLEdBQUtWLEtBQUtRLEtBQUssR0FBRyxHQUFLUixLQUFLVSxRQUFRLEdBQUcsR0FDaElWLEtBQUtRLEtBQUssR0FBRyxHQUFLUixLQUFLVSxRQUFRLEdBQUcsR0FDcENWLEtBQUtRLEtBQUssR0FBRyxHQUFLUixLQUFLUSxLQUFLLEdBQUcsR0FBS1IsS0FBS1UsUUFBUSxHQUFHLEdBQUtWLEtBQUtRLEtBQUssR0FBRyxHQUFLUixLQUFLVSxRQUFRLEdBQUcsR0FBS1YsS0FBS1EsS0FBSyxHQUFHLEdBQUtSLEtBQUtVLFFBQVEsR0FBRyxHQUNoSVYsS0FBS1EsS0FBSyxHQUFHLEdBQUtSLEtBQUtVLFFBQVEsR0FBRyxHQUVwQ1YsS0FBS1EsS0FBSyxHQUFLUixLQUFLUSxLQUFLLEdBQUcsR0FBS1IsS0FBS1UsUUFBUSxHQUFHLEdBQUtWLEtBQUtRLEtBQUssR0FBRyxHQUFLUixLQUFLVSxRQUFRLEdBQUcsR0FDckZWLEtBQUtRLEtBQUssR0FBSyxJQUNkUixLQUFLSyxPQUFTLEtDeENuQixNQUFNWSxFQUVULFlBQVlDLEdBQ1JsQixLQUFLRyxFQUFJLEdBQ1RILEtBQUtJLEVBQUljLEVBQ1RsQixLQUFLTyxJQUFNLE1DRlosTUFBTVksRUFFVCxZQUFZQyxHQUNScEIsS0FBS3FCLE1BQVEsR0FDYnJCLEtBQUtzQixVQUFZLEdBQ2pCdEIsS0FBS3VCLFdBQWEsS0FDbEJ2QixLQUFLd0IsUUFBUyxFQUNkeEIsS0FBS3lCLFdBQVksRUFDakJ6QixLQUFLMEIsT0FBU04sRUFDZHBCLEtBQUsyQixLQUFPLEdBQ1ozQixLQUFLNEIsY0FBZ0IsS0FDckI1QixLQUFLNkIsT0FBUyxJQUNkN0IsS0FBSzhCLFNBQVcsRUFDaEI5QixLQUFLK0IsTUFBUSxFQUNiL0IsS0FBS2dDLFdBQWEsRUFDbEJoQyxLQUFLaUMsV0FBYSxHQUNsQmpDLEtBQUtrQyxZQUFjLEdBQ25CbEMsS0FBS3FCLE1BQU1jLEtBQUssSUFBSXBDLEdBRXhCLFVBQ0lDLEtBQUtxQixNQUFNYyxLQUFLLElBQUlwQyxHQUV4QixjQUNJLElBQUlxQyxFQUFNLElBQUluQixFQUFTTCxLQUFLeUIsTUFBTXpCLEtBQUtDLFVBQVUsSUFBSWIsS0FBSzJCLEtBQUssS0FBSyxHQUNoRVcsRUFBTUMsU0FBU0MsY0FBYyxPQUNqQ0YsRUFBSUcsVUFBWSxXQUNoQkgsRUFBSUksTUFBTUMsS0FBT1AsRUFBSWpDLEVBQUksSUFDekJILEtBQUswQixPQUFPa0IsWUFBWU4sR0FDeEJGLEVBQUk3QixJQUFNK0IsRUFDVnRDLEtBQUtzQixVQUFVYSxLQUFLQyxHQUVwQixJQUFJUyxFQUFRTixTQUFTQyxjQUFjLE9BQ25DSyxFQUFNSixVQUFZLFVBQ2xCSSxFQUFNSCxNQUFNSSxPQUFTVixFQUFJaEMsRUFBSSxLQUU3QixJQUFJMkMsRUFBUVIsU0FBU0MsY0FBYyxPQUNuQ08sRUFBTU4sVUFBWSxVQUNsQk0sRUFBTUwsTUFBTUksT0FBVSxJQUFNVixFQUFJaEMsRUFBSUosS0FBSzJCLEtBQVEsS0FDakRvQixFQUFNTCxNQUFNTSxVQUFZaEQsS0FBSzJCLEtBQU8sS0FDcENXLEVBQUlNLFlBQVlDLEdBQ2hCUCxFQUFJTSxZQUFZRyxHQUNNLE1BQW5CL0MsS0FBS3VCLGFBQ0p2QixLQUFLdUIsV0FBYWEsR0FHMUIsa0JBQ0lhLGFBQVksS0FDTGpELEtBQUt3QixRQUNKeEIsS0FBS2tELGdCQUNYLEtBRU4sWUFBWUMsR0FDUixJQUFJLElBQUl4QyxFQUFFLEVBQUVBLEVBQUV3QyxFQUFJeEMsSUFDZFgsS0FBS29ELFVBR2IsWUFDSXBELEtBQUtxQixNQUFNZ0MsU0FBU0MsSUFDaEIsSUFBSWhCLEVBQU1DLFNBQVNDLGNBQWMsT0FDaEIsR0FBZGMsRUFBS3BELE1BQ0pvQyxFQUFJRyxVQUFZLE9BQ0csR0FBZGEsRUFBS3BELE1BQ1ZvQyxFQUFJRyxVQUFZLGVBQ0csR0FBZGEsRUFBS3BELE1BQ1ZvQyxFQUFJRyxVQUFZLFlBQ0csR0FBZGEsRUFBS3BELE1BQ1ZvQyxFQUFJRyxVQUFZLGVBQ0csR0FBZGEsRUFBS3BELFFBQ1ZvQyxFQUFJRyxVQUFZLG1CQUdwQkgsRUFBSUksTUFBTWEsSUFBTUQsRUFBS2xELEVBQUksSUFDekJrQyxFQUFJSSxNQUFNQyxLQUFPVyxFQUFLbkQsRUFBSSxJQUMxQkgsS0FBSzBCLE9BQU9rQixZQUFZTixHQUN4QmdCLEVBQUsvQyxJQUFNK0IsS0FHbkIsYUFDSVcsYUFBWSxLQUNMakQsS0FBS3dCLFNBQ0p4QixLQUFLcUIsTUFBTWdDLFNBQVNDLElBQ2JBLEVBQUtyRCxPQUNKcUQsRUFBS2pELE9BQVNMLEtBQUs0QixjQUNuQjBCLEVBQUtsRCxHQUFLa0QsRUFBS2pELE1BQ2ZpRCxFQUFLL0MsSUFBSW1DLE1BQVEscUJBQW9DLEdBQWJZLEVBQUtqRCxNQUFhLE9BQzFEaUQsRUFBSy9DLElBQUltQyxNQUFNYSxJQUFNRCxFQUFLbEQsRUFBSSxJQUM5QmtELEVBQUsvQyxJQUFJbUMsTUFBTUMsS0FBT1csRUFBS25ELEVBQUksS0FDMUJtRCxFQUFLbkQsRUFBSSxJQUNkbUQsRUFBS25ELEdBQUtILEtBQUs2QixPQUNmeUIsRUFBSy9DLElBQUltQyxNQUFNQyxLQUFPVyxFQUFLbkQsRUFBSSxJQUM1Qm1ELEVBQUtsRCxFQUFJLEtBQ1JrRCxFQUFLbEQsR0FBSyxHQUNWa0QsRUFBSy9DLElBQUltQyxNQUFNYSxJQUFNRCxFQUFLbEQsRUFBSSxTQUkxQ0osS0FBS3NCLFVBQVUrQixTQUFTakIsSUFDcEJBLEVBQUlqQyxHQUFLSCxLQUFLNkIsT0FDZE8sRUFBSTdCLElBQUltQyxNQUFNQyxLQUFPUCxFQUFJakMsRUFBSSxVQU92QyxJQUVOLFVBQ0k4QyxhQUFZLEtBR1JqRCxLQUFLcUIsTUFBTWdDLFNBQVNDLElBQ2JBLEVBQUtyRCxRQUNEcUQsRUFBS2xELEdBQUssSUFBTWtELEVBQUtsRCxHQUFLLEtBQ3pCa0QsRUFBS2hELE1BQVFOLEtBQUsrQixNQUNsQnVCLEVBQUtyRCxPQUFRLE1BSUgsTUFBbkJELEtBQUt1QixZQUFzQnZCLEtBQUt1QixXQUFXcEIsR0FBSyxJQUFNSCxLQUFLdUIsV0FBV3BCLEdBQUssSUFDMUVILEtBQUtxQixNQUFNZ0MsU0FBU0MsSUFDYkEsRUFBS3JELFFBQ0RxRCxFQUFLbEQsR0FBS0osS0FBS3VCLFdBQVduQixFQUFFLEdBR3RCa0QsRUFBS2xELEdBQUtKLEtBQUt1QixXQUFXbkIsRUFBRUosS0FBSzJCLEtBQUssS0FGM0MyQixFQUFLaEQsTUFBUU4sS0FBSytCLE1BQ2xCdUIsRUFBS3JELE9BQVEsTUFTN0JELEtBQUtzQixVQUFVK0IsU0FBUSxDQUFDakIsRUFBSW9CLEtBQ3JCcEIsRUFBSWpDLEdBQUssS0FDUmlDLEVBQUk3QixJQUFJa0QsU0FFUnpELEtBQUtzQixVQUFVb0MsWUFJRCxNQUFuQjFELEtBQUt1QixZQUNEdkIsS0FBS3VCLFdBQVdwQixFQUFJLEtBQ25CSCxLQUFLdUIsV0FBYXZCLEtBQUtzQixVQUFVLEdBQ2pDdEIsS0FBSytCLFFBQ0xRLFNBQVNvQix1QkFBdUIsU0FBUyxHQUFHQyxVQUFZLFNBQVc1RCxLQUFLK0IsU0FHbEYsR0FFTixXQUNJa0IsYUFBWSxLQUNSLElBQUlZLEdBQVUsRUFDZCxJQUFJLElBQUlsRCxFQUFFLEVBQUVBLEVBQUVYLEtBQUtxQixNQUFNeUMsT0FBT25ELElBQzVCLEdBQUdYLEtBQUtxQixNQUFNVixHQUFHVixNQUFNLENBQ25CNEQsR0FBVSxFQUNWLE1BR0xBLEdBQVc3RCxLQUFLd0IsUUFDZnVDLFlBQVcsS0FDUC9ELEtBQUt3QixRQUFTLEVBSWR1QyxZQUFXLEtBQ1AvRCxLQUFLZ0UsU0FBUSxLQUNmLE9BQ0osT0FFUixLQUVOLFFBQVFDLEdBR0pqRSxLQUFLcUIsTUFBTSxHQUFHcEIsT0FBUSxFQUN0QkQsS0FBS3FCLE1BQU0sR0FBR25CLE1BQVEsRUFDdEJGLEtBQUtxQixNQUFNLEdBQUdsQixFQUFJLEdBQ2xCSCxLQUFLcUIsTUFBTSxHQUFHakIsRUFBSSxHQUNsQkosS0FBS3FCLE1BQU0sR0FBR2hCLE1BQVEsRUFDdEJMLEtBQUtxQixNQUFNLEdBQUdmLE1BQVEsRUFDdEJOLEtBQUtxQixNQUFNZ0MsU0FBU0MsSUFDaEIsR0FBR0EsRUFBS2hELE1BQVFOLEtBQUs4QixTQUFTLENBQzFCOUIsS0FBSzhCLFNBQVd3QixFQUFLaEQsTUFDckIsSUFBSSxJQUFJSyxFQUFFLEVBQUVBLEVBQUUsRUFBRUEsSUFDWlgsS0FBS3FCLE1BQU0sR0FBR1gsUUFBUSxHQUFHQyxHQUFLMkMsRUFBSzVDLFFBQVEsR0FBR0MsR0FFbEQsSUFBSSxJQUFJQSxFQUFFLEVBQUVBLEVBQUUsRUFBRUEsSUFDWlgsS0FBS3FCLE1BQU0sR0FBR1gsUUFBUSxHQUFHQyxHQUFLMkMsRUFBSzVDLFFBQVEsR0FBR0MsT0FNMURYLEtBQUtxQixNQUFNZ0MsU0FBU2EsSUFDSCxNQUFWQSxFQUFHM0QsS0FDRjJELEVBQUczRCxJQUFJa0QsWUFFZnpELEtBQUtzQixVQUFVK0IsU0FBU2EsSUFDUCxNQUFWQSxFQUFHM0QsS0FDRjJELEVBQUczRCxJQUFJa0QsWUFFZnpELEtBQUtxQixNQUFNOEMsT0FBTyxFQUFFbkUsS0FBS3FCLE1BQU15QyxPQUFPLEdBQ3RDOUQsS0FBS3NCLFVBQVU2QyxPQUFPLEVBQUVuRSxLQUFLc0IsVUFBVXdDLFFBR3ZDOUQsS0FBS3VCLFdBQWEsS0FDbEJ2QixLQUFLeUIsVUFBWXdDLEVBQ2pCakUsS0FBSytCLE1BQVEsRUFDYi9CLEtBQUtnQyxhQUNMTyxTQUFTb0IsdUJBQXVCLFNBQVMsR0FBR0MsVUFBWSxZQUFZNUQsS0FBSzhCLDBCQUEwQjlCLEtBQUtnQyxhQUN4R08sU0FBU29CLHVCQUF1QixTQUFTLEdBQUdDLFVBQVksU0FBVzVELEtBQUsrQixNQUNwRS9CLEtBQUt5QixZQUNMekIsS0FBS3dCLFFBQVMsR0FDZnhCLEtBQUs4QixVQUFZLElBQ2hCOUIsS0FBS2tDLFlBQWMsSUFLdkIsSUFBSSxJQUFJdkIsRUFBRSxFQUFFQSxFQUFFWCxLQUFLaUMsV0FBV2pDLEtBQUtrQyxZQUFZdkIsSUFBSSxDQUMvQyxJQUFJeUQsRUFBSSxJQUFJckUsRUFDWixHQUFrQixHQUFkYSxLQUFLQyxTQUFlLEVBQUUsQ0FDdEJ1RCxFQUFFbEUsTUFBUSxFQUNWLElBQUksSUFBSW1FLEVBQUUsRUFBRUEsRUFBRSxFQUFFQSxJQUNaRCxFQUFFMUQsUUFBUSxHQUFHMkQsR0FBS3JFLEtBQUtxQixNQUFNLEdBQUdYLFFBQVEsR0FBRzJELElBQXFCLEVBQWR6RCxLQUFLQyxTQUFXLEdBQUcsR0FFekUsSUFBSSxJQUFJd0QsRUFBRSxFQUFFQSxFQUFFLEVBQUVBLElBQ1pELEVBQUUxRCxRQUFRLEdBQUcyRCxHQUFLckUsS0FBS3FCLE1BQU0sR0FBR1gsUUFBUSxHQUFHMkQsSUFBcUIsRUFBZHpELEtBQUtDLFNBQVcsR0FBRyxRQUd6RSxHQUFrQixHQUFkRCxLQUFLQyxTQUFlLEdBQUcsQ0FDdkJ1RCxFQUFFbEUsTUFBUSxFQUNWLElBQUksSUFBSW1FLEVBQUUsRUFBRUEsRUFBRSxFQUFFQSxJQUNLLEdBQWR6RCxLQUFLQyxTQUFZLEdBQ2hCdUQsRUFBRTFELFFBQVEsR0FBRzJELEdBQW9CLEVBQWR6RCxLQUFLQyxTQUFZLEVBRXBDdUQsRUFBRTFELFFBQVEsR0FBRzJELEdBQUtyRSxLQUFLcUIsTUFBTSxHQUFHWCxRQUFRLEdBQUcyRCxHQUduRCxJQUFJLElBQUlBLEVBQUUsRUFBRUEsRUFBRSxFQUFFQSxJQUNLLEdBQWR6RCxLQUFLQyxTQUFZLEdBQ2hCdUQsRUFBRTFELFFBQVEsR0FBRzJELEdBQW9CLEVBQWR6RCxLQUFLQyxTQUFZLEVBRXBDdUQsRUFBRTFELFFBQVEsR0FBRzJELEdBQUtyRSxLQUFLcUIsTUFBTSxHQUFHWCxRQUFRLEdBQUcyRCxRQUluREQsRUFBRWxFLE1BQVEsRUFDVmtFLEVBQUUxRCxRQUFRLEdBQUdFLEtBQUt5QixNQUFvQixFQUFkekIsS0FBS0MsV0FBOEIsRUFBZEQsS0FBS0MsU0FBWSxFQUl0RWIsS0FBS3FCLE1BQU1jLEtBQUtpQyxHQUlwQnBFLEtBQUtzRSxZQUFZdEUsS0FBS2tDLGFBR3RCbEMsS0FBS3VFLFVBQVV2RSxLQUFLMEIsUUFFeEIsT0FDSTFCLEtBQUtxQixNQUFNZ0MsU0FBU0MsSUFDaEJBLEVBQUtrQixVQUdiLFNBQ0l2QixhQUFZLEtBQ1JqRCxLQUFLcUIsTUFBTWdDLFNBQVNDLElBQ2JBLEVBQUtyRCxRQUNrQixNQUFuQkQsS0FBS3VCLFdBQ0orQixFQUFLbUIsR0FBR3pFLEtBQUt1QixXQUFXcEIsRUFBRUgsS0FBS3VCLFdBQVduQixFQUFFSixLQUFLMkIsTUFHakQyQixFQUFLbUIsR0FBRyxHQUFHLEdBQUd6RSxLQUFLMkIsWUFJakMsSUFFTixPQUNJM0IsS0FBS3FCLE1BQU1nQyxTQUFTQyxJQUNoQm9CLFFBQVFDLElBQUlyQixPQzVSeEJzQixPQUFPQyxPQUFTLEtBRVosTUFBTXpELEVBQVFtQixTQUFTdUMsZUFBZSxRQUNoQ0MsRUFBSSxJQUFJNUQsRUFBS0MsR0FFbkIyRCxFQUFFUixZQUNGUSxFQUFFQyxrQkFDRkQsRUFBRUUsYUFDRkYsRUFBRUcsVUFDRkgsRUFBRUksV0FDRkosRUFBRUssU0FHRmhFLEVBQU1pRSxRQUFVLEtBQ1ROLEVBQUV0RCxZQUFjc0QsRUFBRXZELFFBQ2pCdUQsRUFBRXRELFdBQVksRUFDZHNELEVBQUV2RCxRQUFTLEdBRVh1RCxFQUFFUCxVIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBCaXJke1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKCl7XHJcbiAgICAgICAgdGhpcy5hbGl2ZSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5jb2xvciA9IDA7IC8vIDAgLSBuZXcgYmlyZHMsIDEgLSBjaGFtcGlvbiwgMiAtIGNoaWxkLCAzIC0gbXV0YXRpb25cclxuICAgICAgICB0aGlzLnggPSAzNTtcclxuICAgICAgICB0aGlzLnkgPSA0MDtcclxuICAgICAgICB0aGlzLnNwZWVkID0gMDtcclxuICAgICAgICB0aGlzLnNjb3JlID0gMDtcclxuICAgICAgICB0aGlzLnJlZiA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5CaWFzID0gbmV3IEFycmF5KDMpO1xyXG4gICAgICAgIHRoaXMuV2VpZ2h0cyA9IG5ldyBBcnJheSgyKTtcclxuICAgICAgICB0aGlzLkJpYXNbMF0gPSBuZXcgQXJyYXkoNCk7XHJcbiAgICAgICAgdGhpcy5CaWFzWzFdID0gbmV3IEFycmF5KDIpO1xyXG4gICAgICAgIHRoaXMuV2VpZ2h0c1swXSA9IG5ldyBBcnJheSg4KTtcclxuICAgICAgICB0aGlzLldlaWdodHNbMV0gPSBuZXcgQXJyYXkoMik7XHJcbiAgICAgICAgZm9yKGxldCBpPTA7aTw4O2krKyl7XHJcbiAgICAgICAgICAgIHRoaXMuV2VpZ2h0c1swXVtpXSA9IChNYXRoLnJhbmRvbSgpKjIpLTE7IC8vIHJhbmRvbSBudW1iZXIgYmVldHdlZW4gLTEgYW5kIDFcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yKGxldCBpPTA7aTwyO2krKyl7XHJcbiAgICAgICAgICAgIHRoaXMuV2VpZ2h0c1sxXVtpXSA9IChNYXRoLnJhbmRvbSgpKjIpLTE7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgSnVtcCgpe1xyXG4gICAgICAgIHRoaXMuc3BlZWQgPSAtMC43O1xyXG4gICAgfVxyXG4gICAgQUkoT2JzWCxPYnNZLEhvbGVTaXplKXtcclxuICAgICAgICAvLyBpbnB1dHNcclxuICAgICAgICB0aGlzLkJpYXNbMF1bMF0gPSB0aGlzLnkgLyAxMDA7IC8vIEJpcmQgeVxyXG4gICAgICAgIHRoaXMuQmlhc1swXVsxXSA9IChPYnNYIC0gdGhpcy54KSAvIDEwMDsgLy8gRGlzdGFuY2UgdG8gT2JzXHJcbiAgICAgICAgdGhpcy5CaWFzWzBdWzJdID0gKE9ic1kgLSB0aGlzLnkgKyA0KSAvIDEwMDsgLy8geTFcclxuICAgICAgICB0aGlzLkJpYXNbMF1bM10gPSAoT2JzWSArIEhvbGVTaXplIC0gdGhpcy55IC0gMykgLyAxMDA7IC8vIHkyXHJcbiAgICAgICAgLy8gaGlkZGVuIGxheWVyXHJcbiAgICAgICAgdGhpcy5CaWFzWzFdWzBdID0gdGhpcy5CaWFzWzBdWzBdICogdGhpcy5XZWlnaHRzWzBdWzBdICsgdGhpcy5CaWFzWzBdWzFdICogdGhpcy5XZWlnaHRzWzBdWzFdICsgdGhpcy5CaWFzWzBdWzJdICogdGhpcy5XZWlnaHRzWzBdWzJdIFxyXG4gICAgICAgICsgdGhpcy5CaWFzWzBdWzNdICogdGhpcy5XZWlnaHRzWzBdWzNdO1xyXG4gICAgICAgIHRoaXMuQmlhc1sxXVsxXSA9IHRoaXMuQmlhc1swXVswXSAqIHRoaXMuV2VpZ2h0c1swXVs0XSArIHRoaXMuQmlhc1swXVsxXSAqIHRoaXMuV2VpZ2h0c1swXVs1XSArIHRoaXMuQmlhc1swXVsyXSAqIHRoaXMuV2VpZ2h0c1swXVs2XSBcclxuICAgICAgICArIHRoaXMuQmlhc1swXVszXSAqIHRoaXMuV2VpZ2h0c1swXVs3XTtcclxuICAgICAgICAvLyBvdXRwdXRcclxuICAgICAgICB0aGlzLkJpYXNbMl0gPSB0aGlzLkJpYXNbMV1bMF0gKiB0aGlzLldlaWdodHNbMV1bMF0gKyB0aGlzLkJpYXNbMV1bMV0gKiB0aGlzLldlaWdodHNbMV1bMV07XHJcbiAgICAgICAgaWYodGhpcy5CaWFzWzJdID4gMClcclxuICAgICAgICAgICAgdGhpcy5zcGVlZCA9IC0wLjc7XHJcbiAgICB9XHJcbn0iLCJleHBvcnQgY2xhc3MgT2JzdGFjbGV7XHJcblxyXG4gICAgY29uc3RydWN0b3IoT2JzeSl7XHJcbiAgICAgICAgdGhpcy54ID0gODU7XHJcbiAgICAgICAgdGhpcy55ID0gT2JzeTtcclxuICAgICAgICB0aGlzLnJlZiA9IG51bGw7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgeyBCaXJkIH0gZnJvbSAnLi9iaXJkLmpzJ1xyXG5pbXBvcnQgeyBPYnN0YWNsZSB9IGZyb20gJy4vb2JzdGFjbGUuanMnXHJcblxyXG5leHBvcnQgY2xhc3MgR2FtZXtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihjYW52cyl7XHJcbiAgICAgICAgdGhpcy5CaXJkcyA9IFtdO1xyXG4gICAgICAgIHRoaXMuT2JzdGFjbGVzID0gW107XHJcbiAgICAgICAgdGhpcy5jdXJyZW50T2JzID0gbnVsbDtcclxuICAgICAgICB0aGlzLmdhbWVPbiA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuc3RhcnRHYW1lID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmNhbnZhcyA9IGNhbnZzO1xyXG4gICAgICAgIHRoaXMuSG9sZSA9IDI1O1xyXG4gICAgICAgIHRoaXMuQWNjZWxlcmF0aW9uWSA9IDAuMDE2O1xyXG4gICAgICAgIHRoaXMuU3BlZWRYID0gMC4xOTtcclxuICAgICAgICB0aGlzLlRvcFNjb3JlID0gMDtcclxuICAgICAgICB0aGlzLlNjb3JlID0gMDtcclxuICAgICAgICB0aGlzLkdlbmVyYXRpb24gPSAwO1xyXG4gICAgICAgIHRoaXMuTnVtT2ZCaXJkcyA9IDU1O1xyXG4gICAgICAgIHRoaXMuTnVtT2ZSYW5kb20gPSA1NTtcclxuICAgICAgICB0aGlzLkJpcmRzLnB1c2gobmV3IEJpcmQoKSk7XHJcbiAgICB9XHJcbiAgICBBZGRCaXJkKCl7XHJcbiAgICAgICAgdGhpcy5CaXJkcy5wdXNoKG5ldyBCaXJkKCkpO1xyXG4gICAgfVxyXG4gICAgQWRkT2JzdGFjbGUoKXtcclxuICAgICAgICBsZXQgb2JzID0gbmV3IE9ic3RhY2xlKE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSooMTAwLXRoaXMuSG9sZS0xMykpKzIpO1xyXG4gICAgICAgIGxldCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGRpdi5jbGFzc05hbWUgPSBcIk9ic3RhY2xlXCI7XHJcbiAgICAgICAgZGl2LnN0eWxlLmxlZnQgPSBvYnMueCArIFwiJVwiO1xyXG4gICAgICAgIHRoaXMuY2FudmFzLmFwcGVuZENoaWxkKGRpdik7XHJcbiAgICAgICAgb2JzLnJlZiA9IGRpdjtcclxuICAgICAgICB0aGlzLk9ic3RhY2xlcy5wdXNoKG9icyk7XHJcblxyXG4gICAgICAgIGxldCBwYXJ0MSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgcGFydDEuY2xhc3NOYW1lID0gXCJPYnNQYXJ0XCI7XHJcbiAgICAgICAgcGFydDEuc3R5bGUuaGVpZ2h0ID0gb2JzLnkgKyBcInZoXCI7XHJcblxyXG4gICAgICAgIGxldCBwYXJ0MiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgcGFydDIuY2xhc3NOYW1lID0gXCJPYnNQYXJ0XCI7XHJcbiAgICAgICAgcGFydDIuc3R5bGUuaGVpZ2h0ID0gKDEwMCAtIG9icy55IC0gdGhpcy5Ib2xlKSArIFwidmhcIjtcclxuICAgICAgICBwYXJ0Mi5zdHlsZS5tYXJnaW5Ub3AgPSB0aGlzLkhvbGUgKyBcInZoXCI7XHJcbiAgICAgICAgZGl2LmFwcGVuZENoaWxkKHBhcnQxKTtcclxuICAgICAgICBkaXYuYXBwZW5kQ2hpbGQocGFydDIpO1xyXG4gICAgICAgIGlmKHRoaXMuY3VycmVudE9icyA9PSBudWxsKXtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50T2JzID0gb2JzO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIENyZWF0ZU9ic3RhY2xlcygpe1xyXG4gICAgICAgIHNldEludGVydmFsKCgpPT57XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZ2FtZU9uKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5BZGRPYnN0YWNsZSgpO1xyXG4gICAgICAgIH0sMjAwMCk7XHJcbiAgICB9XHJcbiAgICBDcmVhdGVCaXJkcyhudW0pe1xyXG4gICAgICAgIGZvcihsZXQgaT0wO2k8bnVtO2krKyl7XHJcbiAgICAgICAgICAgIHRoaXMuQWRkQmlyZCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIERyYXdCaXJkcygpe1xyXG4gICAgICAgIHRoaXMuQmlyZHMuZm9yRWFjaCgoYmlyZCk9PntcclxuICAgICAgICAgICAgbGV0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgIGlmKGJpcmQuY29sb3IgPT0gMCl7XHJcbiAgICAgICAgICAgICAgICBkaXYuY2xhc3NOYW1lID0gXCJCaXJkXCI7XHJcbiAgICAgICAgICAgIH1lbHNlIGlmKGJpcmQuY29sb3IgPT0gMSl7XHJcbiAgICAgICAgICAgICAgICBkaXYuY2xhc3NOYW1lID0gXCJCaXJkQ2hhbXBpb25cIjtcclxuICAgICAgICAgICAgfWVsc2UgaWYoYmlyZC5jb2xvciA9PSAyKXtcclxuICAgICAgICAgICAgICAgIGRpdi5jbGFzc05hbWUgPSBcIkJpcmRDaGlsZFwiO1xyXG4gICAgICAgICAgICB9ZWxzZSBpZihiaXJkLmNvbG9yID09IDMpe1xyXG4gICAgICAgICAgICAgICAgZGl2LmNsYXNzTmFtZSA9IFwiQmlyZE11dGF0aW9uXCI7XHJcbiAgICAgICAgICAgIH1lbHNlIGlmKGJpcmQuY29sb3IgPT0gNCl7XHJcbiAgICAgICAgICAgICAgICBkaXYuY2xhc3NOYW1lID0gXCJCaXJkQ29tYmluYXRpb25cIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZGl2LnN0eWxlLnRvcCA9IGJpcmQueSArIFwiJVwiO1xyXG4gICAgICAgICAgICBkaXYuc3R5bGUubGVmdCA9IGJpcmQueCArIFwiJVwiO1xyXG4gICAgICAgICAgICB0aGlzLmNhbnZhcy5hcHBlbmRDaGlsZChkaXYpO1xyXG4gICAgICAgICAgICBiaXJkLnJlZiA9IGRpdjtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIEludmFsaWRhdGUoKXtcclxuICAgICAgICBzZXRJbnRlcnZhbCgoKT0+e1xyXG4gICAgICAgICAgICBpZih0aGlzLmdhbWVPbil7XHJcbiAgICAgICAgICAgICAgICB0aGlzLkJpcmRzLmZvckVhY2goKGJpcmQpPT57XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoYmlyZC5hbGl2ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJpcmQuc3BlZWQgKz0gdGhpcy5BY2NlbGVyYXRpb25ZO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiaXJkLnkgKz0gYmlyZC5zcGVlZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmlyZC5yZWYuc3R5bGUgPSAndHJhbnNmb3JtOiByb3RhdGUoJyArIGJpcmQuc3BlZWQgKiA0NSArICdkZWcpJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmlyZC5yZWYuc3R5bGUudG9wID0gYmlyZC55ICsgXCIlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJpcmQucmVmLnN0eWxlLmxlZnQgPSBiaXJkLnggKyBcIiVcIjtcclxuICAgICAgICAgICAgICAgICAgICB9ZWxzZSBpZihiaXJkLnggPiAwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmlyZC54IC09IHRoaXMuU3BlZWRYO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiaXJkLnJlZi5zdHlsZS5sZWZ0ID0gYmlyZC54ICsgXCIlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGJpcmQueSA8IDg5KXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpcmQueSArPSAwLjc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaXJkLnJlZi5zdHlsZS50b3AgPSBiaXJkLnkgKyBcIiVcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5PYnN0YWNsZXMuZm9yRWFjaCgob2JzKT0+e1xyXG4gICAgICAgICAgICAgICAgICAgIG9icy54IC09IHRoaXMuU3BlZWRYO1xyXG4gICAgICAgICAgICAgICAgICAgIG9icy5yZWYuc3R5bGUubGVmdCA9IG9icy54ICsgXCIlXCI7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIC8qaWYodGhpcy5jdXJyZW50T2JzIT1udWxsKXtcclxuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiSW5mbzNcIilbMF0uaW5uZXJIVE1MID0gYHg6JHt0aGlzLmN1cnJlbnRPYnMueC50b0ZpeGVkKDIpfVxyXG4gICAgICAgICAgICAgICAgICAgIDxicj55OiR7dGhpcy5jdXJyZW50T2JzLnkudG9GaXhlZCgyKX1gO1xyXG4gICAgICAgICAgICAgICAgfSAgICovXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LDEwKTtcclxuICAgIH1cclxuICAgIENoZWNrdXAoKXtcclxuICAgICAgICBzZXRJbnRlcnZhbCgoKT0+e1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gY2hlY2sgZm9yIGRlYWQgYmlyZHNcclxuICAgICAgICAgICAgdGhpcy5CaXJkcy5mb3JFYWNoKChiaXJkKT0+e1xyXG4gICAgICAgICAgICAgICAgaWYoYmlyZC5hbGl2ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoYmlyZC55ID49IDg3IHx8IGJpcmQueSA8PSA1KXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmlyZC5zY29yZSA9IHRoaXMuU2NvcmU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJpcmQuYWxpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBpZih0aGlzLmN1cnJlbnRPYnMgIT0gbnVsbCAmJiB0aGlzLmN1cnJlbnRPYnMueCA+PSAzMSAmJiB0aGlzLmN1cnJlbnRPYnMueCA8PSA0MSl7IC8vIHggcmFuZ2UgMzUoLTQsKzYpXHJcbiAgICAgICAgICAgICAgICB0aGlzLkJpcmRzLmZvckVhY2goKGJpcmQpPT57XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoYmlyZC5hbGl2ZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGJpcmQueSA8PSB0aGlzLmN1cnJlbnRPYnMueSs1KXsgLy8gb2Zmc2V0IGlzICs1XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaXJkLnNjb3JlID0gdGhpcy5TY29yZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpcmQuYWxpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYoYmlyZC55ID49IHRoaXMuY3VycmVudE9icy55K3RoaXMuSG9sZS0zKXsgLy8gb2Zmc2V0IGlzIC0zXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaXJkLnNjb3JlID0gdGhpcy5TY29yZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpcmQuYWxpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGRlbGV0ZSBvYnN0YWNsZXMgb3V0IG9mIHNpZ2h0XHJcbiAgICAgICAgICAgIHRoaXMuT2JzdGFjbGVzLmZvckVhY2goKG9icyxpbmRleCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYob2JzLnggPD0gMTQpe1xyXG4gICAgICAgICAgICAgICAgICAgIG9icy5yZWYucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy90aGlzLk9ic3RhY2xlcy5zcGxpY2UoaW5kZXgsMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5PYnN0YWNsZXMuc2hpZnQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIC8vIGNoYW5nZSBjdXJyZW50IG9ic3RhY2xlXHJcbiAgICAgICAgICAgIGlmKHRoaXMuY3VycmVudE9icyAhPSBudWxsKXtcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuY3VycmVudE9icy54IDwgMzApe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudE9icyA9IHRoaXMuT2JzdGFjbGVzWzFdO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuU2NvcmUrKztcclxuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiU2NvcmVcIilbMF0uaW5uZXJIVE1MID0gXCJzY29yZTpcIiArIHRoaXMuU2NvcmU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LDEpO1xyXG4gICAgfVxyXG4gICAgR2FtZW92ZXIoKXtcclxuICAgICAgICBzZXRJbnRlcnZhbCgoKT0+e1xyXG4gICAgICAgICAgICBsZXQgYWxsZGVhZCA9IHRydWU7XHJcbiAgICAgICAgICAgIGZvcihsZXQgaT0wO2k8dGhpcy5CaXJkcy5sZW5ndGg7aSsrKXtcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuQmlyZHNbaV0uYWxpdmUpe1xyXG4gICAgICAgICAgICAgICAgICAgIGFsbGRlYWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihhbGxkZWFkICYmIHRoaXMuZ2FtZU9uKXtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCk9PntcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWVPbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIC8qZm9yIChsZXQgaSA9IDE7IGkgPCAxMDsgaSsrKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwoaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSovICAgXHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKT0+e1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLk5ld0dhbWUoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sNTAwKTtcclxuICAgICAgICAgICAgICAgIH0sNzAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sODAwKTtcclxuICAgIH1cclxuICAgIE5ld0dhbWUoY2xpY2tUb1N0YXJ0KXtcclxuICAgICAgICBcclxuICAgICAgICAvLyBiZWZvcmUgZGVsZXRpbmdcclxuICAgICAgICB0aGlzLkJpcmRzWzBdLmFsaXZlID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLkJpcmRzWzBdLmNvbG9yID0gMTtcclxuICAgICAgICB0aGlzLkJpcmRzWzBdLnggPSAzNTtcclxuICAgICAgICB0aGlzLkJpcmRzWzBdLnkgPSA0MDtcclxuICAgICAgICB0aGlzLkJpcmRzWzBdLnNwZWVkID0gMDtcclxuICAgICAgICB0aGlzLkJpcmRzWzBdLnNjb3JlID0gMDtcclxuICAgICAgICB0aGlzLkJpcmRzLmZvckVhY2goKGJpcmQpPT57XHJcbiAgICAgICAgICAgIGlmKGJpcmQuc2NvcmUgPiB0aGlzLlRvcFNjb3JlKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuVG9wU2NvcmUgPSBiaXJkLnNjb3JlO1xyXG4gICAgICAgICAgICAgICAgZm9yKGxldCBpPTA7aTw4O2krKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5CaXJkc1swXS5XZWlnaHRzWzBdW2ldID0gYmlyZC5XZWlnaHRzWzBdW2ldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZm9yKGxldCBpPTA7aTwyO2krKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5CaXJkc1swXS5XZWlnaHRzWzFdW2ldID0gYmlyZC5XZWlnaHRzWzFdW2ldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIGRlbGV0ZSBvbGQgc3R1ZmZcclxuICAgICAgICB0aGlzLkJpcmRzLmZvckVhY2goKGVsKT0+e1xyXG4gICAgICAgICAgICBpZihlbC5yZWYgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIGVsLnJlZi5yZW1vdmUoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLk9ic3RhY2xlcy5mb3JFYWNoKChlbCk9PntcclxuICAgICAgICAgICAgaWYoZWwucmVmICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICBlbC5yZWYucmVtb3ZlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5CaXJkcy5zcGxpY2UoMSx0aGlzLkJpcmRzLmxlbmd0aC0xKTtcclxuICAgICAgICB0aGlzLk9ic3RhY2xlcy5zcGxpY2UoMCx0aGlzLk9ic3RhY2xlcy5sZW5ndGgpO1xyXG5cclxuICAgICAgICAvLyBzZXQgbmV3IHByb3BlcnRpZXNcclxuICAgICAgICB0aGlzLmN1cnJlbnRPYnMgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuc3RhcnRHYW1lID0gY2xpY2tUb1N0YXJ0O1xyXG4gICAgICAgIHRoaXMuU2NvcmUgPSAwO1xyXG4gICAgICAgIHRoaXMuR2VuZXJhdGlvbisrO1xyXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJJbmZvMVwiKVswXS5pbm5lckhUTUwgPSBgVG9wU2NvcmU6JHt0aGlzLlRvcFNjb3JlfTxicj5HZW5lcmF0aW9uOiR7dGhpcy5HZW5lcmF0aW9ufWA7XHJcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcIlNjb3JlXCIpWzBdLmlubmVySFRNTCA9IFwic2NvcmU6XCIgKyB0aGlzLlNjb3JlO1xyXG4gICAgICAgIGlmKCF0aGlzLnN0YXJ0R2FtZSlcclxuICAgICAgICAgICAgdGhpcy5nYW1lT24gPSB0cnVlO1xyXG4gICAgICAgIGlmKHRoaXMuVG9wU2NvcmUgPj0gMSl7XHJcbiAgICAgICAgICAgIHRoaXMuTnVtT2ZSYW5kb20gPSAyMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENyZWF0aW5nIEJpcmRzXHJcbiAgICAgICAgLy8gQ2hpbGRyZW5cclxuICAgICAgICBmb3IobGV0IGk9MDtpPHRoaXMuTnVtT2ZCaXJkcy10aGlzLk51bU9mUmFuZG9tO2krKyl7XHJcbiAgICAgICAgICAgIGxldCBiID0gbmV3IEJpcmQoKTtcclxuICAgICAgICAgICAgaWYoKE1hdGgucmFuZG9tKCkqNTApID4gNyl7IC8vIGNoaWxkXHJcbiAgICAgICAgICAgICAgICBiLmNvbG9yID0gMjtcclxuICAgICAgICAgICAgICAgIGZvcihsZXQgaj0wO2o8ODtqKyspe1xyXG4gICAgICAgICAgICAgICAgICAgIGIuV2VpZ2h0c1swXVtqXSA9IHRoaXMuQmlyZHNbMF0uV2VpZ2h0c1swXVtqXSArICgoTWF0aC5yYW5kb20oKSo0LTIpLzEwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZvcihsZXQgaj0wO2o8MjtqKyspe1xyXG4gICAgICAgICAgICAgICAgICAgIGIuV2VpZ2h0c1sxXVtqXSA9IHRoaXMuQmlyZHNbMF0uV2VpZ2h0c1sxXVtqXSArICgoTWF0aC5yYW5kb20oKSo0LTIpLzEwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfWVsc2V7IC8vIG11dGF0aW9uIGFuZCBjb21iaW5hdGlvblxyXG4gICAgICAgICAgICAgICAgaWYoKE1hdGgucmFuZG9tKCkqNTApID4gMjUpeyAvLyBjb21iaW5hdGlvblxyXG4gICAgICAgICAgICAgICAgICAgIGIuY29sb3IgPSA0O1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaj0wO2o8ODtqKyspe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihNYXRoLnJhbmRvbSgpKjMwPjI1KXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuV2VpZ2h0c1swXVtqXSA9IChNYXRoLnJhbmRvbSgpKjIpLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5XZWlnaHRzWzBdW2pdID0gdGhpcy5CaXJkc1swXS5XZWlnaHRzWzBdW2pdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaj0wO2o8MjtqKyspe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihNYXRoLnJhbmRvbSgpKjIwPjE0KXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuV2VpZ2h0c1sxXVtqXSA9IChNYXRoLnJhbmRvbSgpKjIpLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5XZWlnaHRzWzFdW2pdID0gdGhpcy5CaXJkc1swXS5XZWlnaHRzWzFdW2pdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfWVsc2V7IC8vIG11dGF0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgYi5jb2xvciA9IDM7XHJcbiAgICAgICAgICAgICAgICAgICAgYi5XZWlnaHRzWzBdW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSo4KV0gPSAoTWF0aC5yYW5kb20oKSoyKS0xOyAgXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuQmlyZHMucHVzaChiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJhbmRvbSBCaXJkc1xyXG4gICAgICAgIHRoaXMuQ3JlYXRlQmlyZHModGhpcy5OdW1PZlJhbmRvbSk7XHJcblxyXG4gICAgICAgIC8vIERyYXcgQmlyZHNcclxuICAgICAgICB0aGlzLkRyYXdCaXJkcyh0aGlzLmNhbnZhcyk7XHJcbiAgICB9XHJcbiAgICBKdW1wKCl7XHJcbiAgICAgICAgdGhpcy5CaXJkcy5mb3JFYWNoKChiaXJkKT0+e1xyXG4gICAgICAgICAgICBiaXJkLkp1bXAoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIEJpcmRBSSgpe1xyXG4gICAgICAgIHNldEludGVydmFsKCgpPT57XHJcbiAgICAgICAgICAgIHRoaXMuQmlyZHMuZm9yRWFjaCgoYmlyZCk9PntcclxuICAgICAgICAgICAgICAgIGlmKGJpcmQuYWxpdmUpe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuY3VycmVudE9icyAhPSBudWxsKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmlyZC5BSSh0aGlzLmN1cnJlbnRPYnMueCx0aGlzLmN1cnJlbnRPYnMueSx0aGlzLkhvbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiaXJkLkFJKDkwLDI1LHRoaXMuSG9sZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LDEwKTtcclxuICAgIH1cclxuICAgIFRlc3QoKXtcclxuICAgICAgICB0aGlzLkJpcmRzLmZvckVhY2goKGJpcmQpPT57XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGJpcmQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IHsgR2FtZSB9IGZyb20gJy4vZ2FtZS5qcyc7XHJcblxyXG53aW5kb3cub25sb2FkID0gKCkgPT57XHJcbiAgICBcclxuICAgIGNvbnN0IGNhbnZzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtYWluXCIpO1xyXG4gICAgY29uc3QgZyA9IG5ldyBHYW1lKGNhbnZzKTtcclxuICAgIC8vZy5DcmVhdGVCaXJkcyg1MCk7XHJcbiAgICBnLkRyYXdCaXJkcygpO1xyXG4gICAgZy5DcmVhdGVPYnN0YWNsZXMoKTtcclxuICAgIGcuSW52YWxpZGF0ZSgpO1xyXG4gICAgZy5DaGVja3VwKCk7XHJcbiAgICBnLkdhbWVvdmVyKCk7XHJcbiAgICBnLkJpcmRBSSgpO1xyXG4gICAgLy9nLlRlc3QoKTtcclxuICAgIFxyXG4gICAgY2FudnMub25jbGljayA9ICgpPT57XHJcbiAgICAgICAgaWYoZy5zdGFydEdhbWUgJiYgIWcuZ2FtZU9uKXtcclxuICAgICAgICAgICAgZy5zdGFydEdhbWUgPSBmYWxzZTtcclxuICAgICAgICAgICAgZy5nYW1lT24gPSB0cnVlO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBnLkp1bXAoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl0sInNvdXJjZVJvb3QiOiIifQ==